# ğŸš€ å°å­¦æˆç»©ç®¡ç†ç³»ç»Ÿ (Elementary School Grade Management System)

## æœ€ç»ˆè§„åˆ’æ–‡æ¡£

**æ ¸å¿ƒç„¦ç‚¹ï¼šé«˜æ•ˆçš„æˆç»©ç®¡ç†ã€æ‰¹é‡å¯¼å…¥å’Œæ·±åº¦æ™ºèƒ½åˆ†æ**

## 1. é¡¹ç›®ç›®æ ‡

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªé«˜æ€§èƒ½ã€æ™ºèƒ½åŒ–çš„ Serverless å°å­¦æˆç»©ç®¡ç†ç³»ç»Ÿï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š

- **é«˜æ•ˆç®¡ç†ä¸å¯¼å…¥**ï¼šæ•™å¸ˆèƒ½å¤Ÿé€šè¿‡ API æˆ– Excel æ‰¹é‡å¯¼å…¥ï¼Œå¿«é€Ÿå®Œæˆå­¦ç”Ÿå„ç§‘æˆç»©çš„å½•å…¥å’Œç®¡ç†ã€‚
- **æ·±åº¦æ™ºèƒ½åˆ†æ**ï¼šåˆ©ç”¨ Cloudflare Workers AI æä¾›è‡ªç„¶è¯­è¨€æ€»ç»“å’Œä¸ªæ€§åŒ–å»ºè®®ï¼Œå°†åˆ†æä»æ•°æ®å±‚é¢æå‡åˆ°æ•™å­¦æŒ‡å¯¼å±‚é¢ã€‚
- **é›¶æ•£éƒ¨ç½²**ï¼šç³»ç»Ÿï¼ˆåŒ…æ‹¬å‰ç«¯ç•Œé¢å’Œåç«¯ APIï¼‰å®Œå…¨éƒ¨ç½²åœ¨ Cloudflare Workers å¹³å°ä¸Šï¼Œåˆ©ç”¨ D1 å’Œ R2 å®ç°é«˜æ€§èƒ½æ•°æ®å­˜å‚¨å’Œå…¨çƒåˆ†å‘ã€‚

## ğŸ’» 2. æŠ€æœ¯æ ˆä¸éƒ¨ç½²ç¯å¢ƒ

| ç±»åˆ« | æŠ€æœ¯/æœåŠ¡ | ç”¨é€”è¯´æ˜ |
|------|----------|----------|
| åç«¯æ ¸å¿ƒ | Python (Workers) | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€API æ¥å£ã€æ•°æ®åˆ†æè®¡ç®—ã€Excel æ–‡ä»¶å¤„ç† |
| AI æ™ºèƒ½ | Cloudflare Workers AI | ç”¨äºç”Ÿæˆè‡ªç„¶è¯­è¨€æ€»ç»“å’Œä¸ªæ€§åŒ–å­¦ä¹ å»ºè®® |
| æ•°æ®åº“ | Cloudflare D1 | å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼ˆå­¦ç”Ÿã€ç­çº§ã€æˆç»©æ•°æ®ï¼‰ |
| å­˜å‚¨ | Cloudflare R2 | å­˜å‚¨éç»“æ„åŒ–æ•°æ®ï¼ˆè€ƒå·å›¾ç‰‡ã€å­¦ä¸šæŠ¥å‘Š PDF ç­‰ï¼‰ |
| å‰ç«¯ | HTML, CSS, JavaScript | æ„å»ºç”¨æˆ·ç•Œé¢ã€æ•°æ®å¯è§†åŒ–å›¾è¡¨ã€æˆç»©å¯¼å…¥ç•Œé¢ |
| éƒ¨ç½²ç¯å¢ƒ | Cloudflare Workers & Pages | Workers ç»Ÿä¸€å¤„ç†é™æ€æ–‡ä»¶å’Œ API è·¯ç”±ï¼Œå®ç°å…¨æ ˆ Serverless |

## ğŸ›ï¸ 3. ç³»ç»Ÿæ¶æ„ (Cloudflare Serverless)

| å±‚æ¬¡ | ç»„ä»¶ | èŒè´£ | ç»‘å®šåç§° (wrangler.toml é…ç½®) |
|------|------|------|----------------------------|
| æœåŠ¡å…¥å£ | Python Worker | ç»Ÿä¸€å¤„ç†å‰ç«¯é™æ€æ–‡ä»¶ (/) å’Œ API è¯·æ±‚ (/api/*) | N/A |
| æ•°æ®å±‚ | Cloudflare D1 | å­˜å‚¨å­¦ç”Ÿã€ç­çº§ã€æˆç»©ç­‰æ ¸å¿ƒæ•°æ® | GRADE_DB |
| æ–‡ä»¶å­˜å‚¨ | Cloudflare R2 | å­˜å‚¨æ•™å¸ˆä¸Šä¼ çš„è€ƒå·å›¾ç‰‡ | ASSET_BUCKET |
| æ™ºèƒ½åˆ†æ | Workers AI | æ¥æ”¶ D1 æ•°æ®ï¼Œç”Ÿæˆæ–‡æœ¬åé¦ˆ | AI |

## ğŸ§± 4. æ•°æ®æ¨¡å‹ (Cloudflare D1)

### Users è¡¨

| å­—æ®µ | æ•°æ®ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|------|---------|------|------|
| id | TEXT | ç”¨æˆ·ID | Primary |
| username | TEXT | ç”¨æˆ·å | Unique |
| password_hash | TEXT | å¯†ç å“ˆå¸Œå€¼ |  |
| role | TEXT | è§’è‰²æƒé™ |  |
| class_id | TEXT | ç­çº§ID |  |

### Classes è¡¨

| å­—æ®µ | æ•°æ®ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|------|---------|------|------|
| id | TEXT | ç­çº§ID | Primary |
| grade_level | INTEGER | å¹´çº§ |  |
| class_name | TEXT | ç­çº§åç§° |  |

### Students è¡¨

| å­—æ®µ | æ•°æ®ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|------|---------|------|------|
| id | TEXT | å­¦ç”ŸID | Primary |
| name | TEXT | å­¦ç”Ÿå§“å |  |
| student_id | TEXT | å­¦å· | Unique |
| class_id | TEXT | ç­çº§ID | Indexed |

### Grades è¡¨

| å­—æ®µ | æ•°æ®ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|------|---------|------|------|
| id | TEXT | æˆç»©ID | Primary |
| student_id | TEXT | å­¦ç”ŸID | Indexed |
| subject | TEXT | ç§‘ç›® |  |
| score | REAL | åˆ†æ•° |  |
| exam_date | TEXT | è€ƒè¯•æ—¥æœŸ |  |
| exam_name | TEXT | è€ƒè¯•åç§° |  |
| teacher_id | TEXT | æ•™å¸ˆID |  |

## âš™ï¸ 5. æ ¸å¿ƒåŠŸèƒ½ä¸ API æ¥å£

### 5.1. è®¤è¯ä¸åŸºç¡€æˆç»©ç®¡ç† (Authentication & Basic CRUD)

| åŠŸèƒ½ | API Endpoint | è§’è‰²æƒé™ | æè¿° |
|------|-------------|---------|------|
| ç™»å½•/æ³¨é”€ | POST /api/login, POST /api/logout | All | ä¼šè¯ç®¡ç† |
| å½•å…¥/æ›´æ–°æˆç»© | POST /api/grades, PUT /api/grades/<ID> | teacher, admin | å½•å…¥æˆ–ä¿®æ”¹æˆç»©è®°å½• |
| æŸ¥è¯¢ç­çº§æˆç»© | GET /api/grades?class_id=<ID>&exam_name=<NAME> | teacher, admin | æŸ¥è¯¢æŒ‡å®šè€ƒè¯•çš„ç­çº§åŸå§‹æˆç»©åˆ—è¡¨ |

### 5.2. ğŸ“‚ æ‰¹é‡å¯¼å…¥ä¸æ–‡ä»¶åŠŸèƒ½ (Bulk Import & File Management)

| åŠŸèƒ½ | API Endpoint | è§’è‰²æƒé™ | æè¿° |
|------|-------------|---------|------|
| ä¸‹è½½å¯¼å…¥æ¨¡æ¿ | GET /api/template/grades.xlsx | teacher, admin | Worker åŠ¨æ€ç”Ÿæˆå¹¶è¿”å›æ ‡å‡†æˆç»©å¯¼å…¥ Excel æ¨¡æ¿ã€‚Worker ç”Ÿæˆ XLSX æ–‡ä»¶ |
| æ‰¹é‡å¯¼å…¥æˆç»© | POST /api/import/grades | teacher, admin | æ¥æ”¶ Excel æ–‡ä»¶ï¼ŒWorker è§£æã€éªŒè¯å¹¶æ‰¹é‡æ’å…¥ Grades æ•°æ®ã€‚Worker: è§£æ XLSXï¼›D1: æ‰¹é‡æ’å…¥ Grades |
| ä¸Šä¼ è€ƒå·å›¾ç‰‡ | POST /api/assets/upload | teacher, admin | æ•™å¸ˆä¸Šä¼ æœ¬æ¬¡è€ƒè¯•çš„è€ƒå·åŸä»¶å›¾ç‰‡ã€‚R2: Put Object (ASSET_BUCKET) |

### 5.3. ğŸ“Š æ·±åº¦æ•°æ®åˆ†æä¸æ™ºèƒ½åé¦ˆ (Data Analysis & Workers AI)

| ç»´åº¦ | API Endpoint | è§’è‰²æƒé™ | æè¿° |
|------|-------------|---------|------|
| ç­çº§æ€»ä½“åˆ†æ | GET /api/analysis/class/<CLASS_ID> | teacher, admin | è®¡ç®—ç­çº§å¹³å‡åˆ†ã€ä¸­ä½æ•°ã€åˆ†å¸ƒã€è–„å¼±ç§‘ç›®ç­‰å…³é”®æŒ‡æ ‡ã€‚D1: Select, AVG, Group By |
| å­¦ç”Ÿçºµå‘è¶‹åŠ¿ | GET /api/analysis/student/longitudinal/<STUDENT_ID> | All (é™æœ¬äºº/æ•™å¸ˆ) | ã€ä¼˜åŒ–ï¼šè¿›æ­¥è¶‹åŠ¿ã€‘ æŸ¥è¯¢å•ä¸ªå­¦ç”Ÿå¤šç§‘ç›®å†æ¬¡è€ƒè¯•çš„æˆç»©å˜åŒ–æ›²çº¿ã€ç­çº§æ’åå˜åŒ–è¶‹åŠ¿å’Œè¿›æ­¥é€Ÿåº¦/æ½œåŠ›åˆ†æã€‚D1: Select, Order By exam_date, Python Logic for Speed/Potential |
| æ¨ªå‘å¯¹æ¯”åˆ†æ | GET /api/analysis/comparison/<CLASS_ID>?exam=<NAME> | teacher, admin | ã€æ–°å¢ï¼šå¹´çº§å¯¹æ¯”ã€‘ ç­çº§æ•´ä½“æˆç»©ä¸å¹´çº§å¹³å‡åˆ†/å¹´çº§ä¸­ä½æ•°å¯¹æ¯”ï¼›å•ä¸ªå­¦ç”Ÿä¸ç­çº§/å¹´çº§å¹³å‡åˆ†å¯¹æ¯”ã€‚D1: Select, Join, AVG, Group By |
| å­¦ç§‘å…³è”åˆ†æ | GET /api/analysis/correlation/<CLASS_ID>?subject1=<SUB1>&subject2=<SUB2> | teacher, admin | ã€æ–°å¢ï¼šå…³è”æ€§ã€‘ åˆ†æç­çº§å†…ä¸¤ä¸ªç§‘ç›®æˆç»©çš„ç›¸å…³æ€§ç³»æ•° (Correlation)ï¼Œç”¨äºè¯†åˆ«åç§‘é—®é¢˜æˆ–å­¦ç§‘äº’åŠ©æ€§ã€‚D1: Select, Python/Worker Statistical Logic |
| AI æ€»ç»“æŠ¥å‘Š | GET /api/analysis/class/summary/<CLASS_ID> | teacher, admin | AI å¢å¼ºï¼š Worker æå– D1 åˆ†ææ•°æ®ï¼ˆåŒ…å«å¯¹æ¯”å’Œè¶‹åŠ¿ï¼‰ï¼Œè°ƒç”¨ Workers AI (LLM) ç”Ÿæˆä¸€æ®µè‡ªç„¶è¯­è¨€çš„ç­çº§æˆç»©æ€»ç»“ã€‚D1 -> Workers AI |
| AI ä¸ªæ€§åŒ–å»ºè®® | GET /api/analysis/student/advice/<STUDENT_ID> | All (é™æœ¬äºº/æ•™å¸ˆ) | AI å¢å¼ºï¼š Worker æå–å­¦ç”Ÿæ•°æ®ï¼ˆåŒ…å«è¿›æ­¥é€Ÿåº¦ï¼‰ï¼Œè°ƒç”¨ Workers AI (LLM) ç”Ÿæˆä¸ªæ€§åŒ–çš„å­¦ä¹ æ”¹è¿›å»ºè®®ã€‚D1 -> Workers AI |
| è–„å¼±ç¾¤ä½“è¯†åˆ« | GET /api/analysis/weakpoints/<CLASS_ID> | teacher, admin | ç­›é€‰å‡ºæˆç»©è¿ç»­ä½äºç­çº§å¹³å‡åˆ†æˆ–è¿›æ­¥é€Ÿåº¦ä½äºç­çº§å¹³å‡æ°´å¹³çš„é‡ç‚¹å…³æ³¨å­¦ç”Ÿåˆ—è¡¨ã€‚D1: Select, Python logic |

### 5.4. å­¦ç”Ÿ/å®¶é•¿æŸ¥è¯¢åŠŸèƒ½ (Student/Parent)

| åŠŸèƒ½ | API Endpoint | æè¿° |
|------|-------------|------|
| æŸ¥è¯¢ä¸ªäººæˆç»© | GET /api/my/grades | æŸ¥è¯¢æ‰€æœ‰å†å²æˆç»© |
| ä¸‹è½½æŠ¥å‘Š | GET /api/reports/pdf | ç”Ÿæˆå¹¶è¿”å›å­¦ç”Ÿçš„ PDF æˆç»©å•æˆ–æŠ¥å‘Š |

## ğŸ› ï¸ 6. éƒ¨ç½²ä¸é…ç½®ç»†èŠ‚

### 6.1. wrangler.toml é…ç½®è¦ç‚¹

AI ç¼–ç¨‹å·¥å…·å¿…é¡»é…ç½®ä»¥ä¸‹ Bindings æ¥å¯ç”¨æ‰€æœ‰ Cloudflare æœåŠ¡ï¼š

```toml
name = "elementary-grade-worker"
main = "src/worker.py"
compatibility_date = "2024-01-01"

[vars]
JWT_SECRET = "YOUR_HIGHLY_SECRET_KEY"

[[d1_databases]]
binding = "GRADE_DB"
database_name = "elementary-grades-db"
database_id = "..."

[[r2_buckets]]
binding = "ASSET_BUCKET"
bucket_name = "elementary-assets"

[[ai]]
binding = "AI"

[site]
bucket = "./dist"
```

### 6.2. å®‰å…¨ä¸æ€§èƒ½

- **è®¤è¯/æˆæƒ**ï¼šä½¿ç”¨ JWT è¿›è¡Œä¼šè¯ç®¡ç†ï¼›API å¿…é¡»æ£€æŸ¥ role ç¡®ä¿åªæœ‰ teacher/admin æ‰§è¡Œæ•°æ®ä¿®æ”¹ã€å¯¼å…¥å’Œæ•æ„Ÿåˆ†ææ“ä½œã€‚
- **æ‰¹é‡æ“ä½œ**ï¼šExcel å¯¼å…¥åˆ° D1 åº”ä½¿ç”¨æ‰¹é‡æ’å…¥æˆ–äº‹åŠ¡åŠŸèƒ½ï¼Œç¡®ä¿æ•°æ®å†™å…¥çš„åŸå­æ€§å’Œä¸€è‡´æ€§ã€‚
- **Workers AI é€»è¾‘**ï¼šåœ¨è°ƒç”¨ AI æ¨¡å‹ä¹‹å‰ï¼ŒPython Worker å¿…é¡»é¦–å…ˆä» D1 æå–å¹¶æ ¼å¼åŒ–æ‰€éœ€çš„ä¸Šä¸‹æ–‡æ•°æ®ã€‚è®¾è®¡æ¸…æ™°çš„æç¤ºè¯ (Prompt) æ¥æŒ‡å¯¼ LLM çš„è¾“å‡ºé£æ ¼å’Œå†…å®¹ã€‚

D1æ•°æ®åº“ï¼šclass-pyï¼Œ2fd2778c-b7a1-4d87-bdba-799c23822d55
R2ï¼šclass-py